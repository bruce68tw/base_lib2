//import 'dart:developer';
import 'package:flutter/material.dart';
import 'log_ut.dart';

//static class, cannot use _Fun
//waiting & message 不可同時顯示!!
class ToolUt {
  //目前是否顯示waiting
  static bool _isWaiting = false;
  //static BuildContext? _waitCnt;

  //show msg box
  static void msg(BuildContext? context, String info, [Function? fnOk]) {
    if (context == null){
      LogUt.error(info);
      return;
    }

    //close wait first if need
    closeWait(context);

    // set up the button
    var okBtn = TextButton(
      child: const Text('OK'),
      onPressed: (){
        Navigator.pop(context);
        if (fnOk != null){
          fnOk();
        } 
    });

    // set up the AlertDialog
    var dialog = AlertDialog(
      //title: Text('My title'),
      content: Text(info),
      actions: [
        okBtn,
      ],
    );

    // show the dialog
    showDialog(
      context: context,
      builder: (BuildContext context2) {
        return dialog;
      },
    );
  }

  //show msg box
  static void ans(BuildContext? context, String info, [Function? onYes]) {
    if (context == null) return;
    
    //close waiting first
    closeWait(context);

    // set up the button
    var okBtn = TextButton(
      child: const Text('Yes'),
      onPressed: () {
        closeForm(context);
        if (onYes != null) onYes();
      },
    );
    var cancelBtn = TextButton(
      child: const Text('No'),
      onPressed: () => Navigator.pop(context),
    );

    // set up the AlertDialog
    var alert = AlertDialog(
      content: Text(info),
      actions: [
        okBtn,
        cancelBtn,
      ],
    );

    // show the dialog
    showDialog(
      context: context,
      builder: (BuildContext context) {
        return alert;
      },
    );
  }

  //open waiting msg
  static void openWait(BuildContext? context) {
    if (context == null) return;

    //set global
    _isWaiting = true;

    showDialog(
      context: context,
      barrierDismissible: false,
      builder: (BuildContext context2) {
        //_waitCnt = context2;  //set global
        return Dialog(
          child: Container(
            width: 150,
            height: 70,
            padding: const EdgeInsets.all(10),
            child: const ListTile(
              horizontalTitleGap: 20,
              leading: CircularProgressIndicator(),
              title: Text('Working...'),
            ),
          ),
        );
      },
    );
  }

  //close waiting msg
  static void closeWait(BuildContext? context) {
    if (context == null || !_isWaiting) return;

    _isWaiting = false; //reset
    //_waitCnt == null;
    Navigator.of(context, rootNavigator: true).pop(context);
    //closeForm(_waitCnt!);
  }

  //close popup
  static void closeForm(BuildContext? context) {
    if (context == null) return;
    Navigator.pop(context);
  }

  //close popup and return msg
  static void closeFormMsg(BuildContext? context, String msg) {
    if (context == null) return;
    Navigator.pop(context, msg);
  }

  //open form
  static void openForm(BuildContext? context, Widget form, [bool replace = false]) {
    if (context == null) return;

    //close waiting first
    closeWait(context);

    if (replace){
      Navigator.pushReplacement(context,
        MaterialPageRoute(builder: (context) => form),
      );
    } else {
      Navigator.push(context,
        MaterialPageRoute(builder: (context) => form),
      );
    }
  }

  //open form & show msg
  static Future<String> openFormMsgA(BuildContext context, Widget form) async {
    //close waiting first
    closeWait(context);

    var msg = await Navigator.push(context,
      MaterialPageRoute(builder: (context) => form)
    );
    return (msg == null) ? '' : msg.toString();
  }
  
  /*
  static void openModal(BuildContext context, Widget form, [bool replace = false]) {
    if (context == null) return;
    if (replace){
      Navigator.pushReplacement(context,
        MaterialPageRoute(builder: (context) => form),
      );
    } else {
      Navigator.push(context,
        MaterialPageRoute(builder: (context) => form),
      );
    }
  }
  */
  
} //class
